---
title: "Blogging with hugo and GitHub Pages"
date: 2018-07-22T17:55:15+01:00
---

This post describes how I configure my blog using
[`hugo`](https://gohugo.io/) and GitHub pages. I chose `hugo` because
it is simple, has no external dependencies, and generates static pages
which are easily hostable on GitHub pages.

There are a number of other guides out there, from which I copied some
of the setup, notably
[this](https://keithpblog.org/post/hugo-website-on-githubpages/) and
[this](https://github.com/hypriot/blog) guide.

`hugo` generates a static website under `./public` and GitHub pages
are served from a repository called `<username>.github.io`. Some other
blogs have a separate repository to keep the "source" and then push
the static pages to `<username>.github.io`. Here, we use a branch on
`<username>.github.io`, called `src`, and then move the generated
static site to the `master` branch.

## Setup

Install `hugo` locally. I used `brew install hugo`.

Create a repository on GitHub called `<username>.github.io`. Then
clone it locally, create and push a commit on the `master`
branch. Finally create the `src` branch:

```sh
git clone git@github.com:<username>/<username>.github.io.git
cd <username>.github.io.git
echo ".public" >> .gitignore
git add . && git commit -s -m "Add .gitignore on the master branch"
git remote add origin git@github.com:rn/rn.github.io.git
git push -u origin master

git checkout -b src
```

In the root of `<username>.github.io` (on the `src` branch), create a
new `hugo` site and then move it to the root of the repository and
check it in. Note, `hugo new` creates several empty directories. To
preserve the layout in git, we create a dummy file in each of these
empty directories:

```sh
hugo new site blog
mv blog/* .
rmdir blog
touch content/.dummy
touch data/.dummy
touch layouts/.dummy
touch static/.dummy
git add . && git commit -s -m "Empty hugo site"
```

Next we are going to install a theme. I'm using the [Ananke
Theme](https://themes.gohugo.io/gohugo-theme-ananke/), like the `hugo`
tutorial. However, unlike the `hugo` tutorials, I'm not going to use a
`git` submodule, but check in the theme files directly (bit note the
commit hash in the commit message):

```sh
git clone https://github.com/budparr/gohugo-theme-ananke.git themes/ananke
HASH=$(git -C themes/ananke rev-parse HEAD)
rm -rf themes/ananke/.git
git add themes/ananke && git commit -s -m "Add Ananke themse commit: $HASH"

echo 'theme = "ananke"' >> config.toml
git commit -as -m "Select Ananke theme"
```

Finally we tweak `config.toml`. Here is a copy of mine, at this stage (note the `https` in the `baseURL`):

```
baseURL = "https://rn.github.io/"
languageCode = "en-us"
title = "Rolf Neugebauer's Blog"
theme = "ananke"
```

Check it in:

```sh
git commit -as -m "Initial configuration"
```

At this point you get checkout the new site with:

```sh
hugo server -D
```

## Publishing

`hugo` will generate the static web pages in the `./public` directory
on the `src` branch. We then move the content of this directory to the
root directory of the `master` branch: We do this by first moving
`./public` to `.public`, switch branches, delete all files, and then
move the content from `.public` to `.`, check it in and push to
GitHub. See the script below. But first, we create a `.gitignore` file
to prevent us accidentally checking in the generated files on the
`src` branch.

```
git checkout src
echo "/public" > .gitignore
echo "/.public" >> .gitignore
git add .gitignore && git commit -s -m "Add .gitignore on the src branch"
```

To publish the blog, I use this script (checked in as `./publish.sh`
on the `src` branch.):

```sh
#!/bin/sh
set -e
set -x

git diff-index --quiet HEAD -- || (echo "Please commit any pending changes."; exit 1)
git ls-files --exclude-standard --others || (echo "Please commit any pending changes."; exit 1)

git push origin src

HASH=$(git rev-parse HEAD)

HUGO_ENV="production" hugo

mv public .public

git checkout master
git pull

rm -rf *
mv .public/* .
rm -rf .public

git add . && git commit -s -m "Publish $HASH"
git push origin master

git checkout src
git clean -fdqx
```

The script makes sure we don't publish from a dirty directory and
after it is finished, switches back to the `src` branch and cleans it
(i.e. removes any temporary files).


## Adding content

Add new posts is straight forward. On the `src` branch, just use `hugo
new posts/foo.md` to create a template and edit it. You can
check the new website with:

```sh
hugo server -D
```

Once happy, remove the `draft` tag from the markdown file, check the
post in (on the `src` branch), and use `./publish.sh` to push the
changes to GitHub.

